# Terraform Setup Guide for Book Review PortalnnThis guide provides comprehensive instructions for setting up Terraform deployment to AWS using GitHub Actions with OIDC authentication.nn## Prerequisitesnn- AWS Account with appropriate permissionsn- GitHub repository with Actions enabledn- Terraform installed locally (optional for local testing)nn## AWS Setupnn### 1. Create S3 Bucket for Terraform StatennCreate an S3 bucket to store Terraform state files:nn```bashnaws s3 mb s3://book-review-portal-terraform-staten```nn### 2. Create DynamoDB Table for State Locking (Optional)nnIf you want state locking (recommended for team environments):nn```bashnaws dynamodb create-table \n  --table-name terraform-state-lock \n  --attribute-definitions AttributeName=LockID,AttributeType=S \n  --key-schema AttributeName=LockID,KeyType=HASH \n  --billing-mode PAY_PER_REQUEST \n  --region us-east-1n```nn### 3. Create IAM Role for GitHub Actions OIDCnnCreate an IAM role that GitHub Actions can assume using OIDC:nn#### Step 1: Create Trust PolicynnCreate a file named `aws-oidc-trust-policy.json`:nn```jsonn{n  "Version": "2012-10-17",n  "Statement": [n    {n      "Effect": "Allow",n      "Principal": {n        "Federated": "arn:aws:iam::YOUR_AWS_ACCOUNT_ID:oidc-provider/token.actions.githubusercontent.com"n      },n      "Action": "sts:AssumeRoleWithWebIdentity",n      "Condition": {n        "StringEquals": {n          "token.actions.githubusercontent.com:aud": "sts.amazonaws.com"n        },n        "StringLike": {n          "token.actions.githubusercontent.com:sub": "repo:YOUR_GITHUB_USERNAME/book-review-portal:*"n        }n      }n    }n  ]n}n```nn#### Step 2: Create IAM Rolenn```bashnaws iam create-role \n  --role-name GitHubActionsOIDCRole \n  --assume-role-policy-document file://aws-oidc-trust-policy.jsonn```nn#### Step 3: Attach Required PoliciesnnAttach policies for the resources you want to manage:nn```bashn# For full access (adjust based on your needs)naws iam attach-role-policy \n  --role-name GitHubActionsOIDCRole \n  --policy-arn arn:aws:aws:policy/AdministratorAccessnn# Or attach specific policies:naws iam attach-role-policy \n  --role-name GitHubActionsOIDCRole \n  --policy-arn arn:aws:aws:policy/AmazonS3FullAccessnaws iam attach-role-policy \n  --role-name GitHubActionsOIDCRole \n  --policy-arn arn:aws:aws:policy/AmazonEC2FullAccessnaws iam attach-role-policy \n  --role-name GitHubActionsOIDCRole \n  --policy-arn arn:aws:aws:policy/AmazonRDSFullAccessnaws iam attach-role-policy \n  --role-name GitHubActionsOIDCRole \n  --policy-arn arn:aws:aws:policy/AmazonECSFullAccessnaws iam attach-role-policy \n  --role-name GitHubActionsOIDCRole \n  --policy-arn arn:aws:aws:policy/AmazonCloudFrontFullAccessn```nn## GitHub Repository Setupnn### 1. Create RepositorynnCreate a new repository named `book-review-portal` in your GitHub account or organization.nn### 2. Configure GitHub SecretsnnAdd the following secrets to your repository:nn- `AWS_REGION`: Your AWS region (e.g., `us-east-1`)n- `AWS_ROLE_ARN`: The ARN of the IAM role created aboven- `TF_VAR_db_password`: Your database passwordnn### 3. Configure OIDC ProvidernnIn your AWS account, create an OIDC provider for GitHub Actions:nn```bashnaws iam create-open-id-connect-provider \n  --url https://token.actions.githubusercontent.com \n  --client-id-list sts.amazonaws.com \n  --thumbprint-list 6938fd4d98bab03faadb97b34396831e3780aea1n```nn## Terraform Configurationnn### 1. Backend ConfigurationnnThe Terraform configuration uses an S3 backend for state storage:nn```hclnterraform {n  required_version = ">= 1.0"n  required_providers {n    aws = {n      source  = "hashicorp/aws"n      version = "~> 5.0"n    }n    random = {n      source  = "hashicorp/random"n      version = "~> 3.0"n    }n    null = {n      source  = "hashicorp/null"n      version = "~> 3.0"n    }n  }nn  backend "s3" {n    bucket         = "book-review-portal-terraform-state"n    key            = "terraform.tfstate"n    region         = "us-east-1"n    encrypt        = truen    dynamodb_table = "terraform-state-lock"n  }n}n```nn### 2. Variables ConfigurationnnUpdate `terraform/terraform.tfvars` with your specific values:nn```hclnaws_region   = "us-east-1"nenvironment  = "dev"nproject_name = "book-review-portal"nn# Database configurationnvpc_cidr        = "10.0.0.0/16"nprivate_subnets = ["10.0.1.0/24", "10.0.2.0/24"]npublic_subnets  = ["10.0.101.0/24", "10.0.102.0/24"]nninstance_type = "t3.micro"ndb_username   = "admin"n# db_password should be set via environment variable or CLIn# export TF_VAR_db_password="YourSecurePassword123!"nnkey_name = "" # Set this to your EC2 key pair name if you want SSH accessn```nn## GitHub Actions WorkflownnThe workflow file `.github/workflows/terraform-deploy.yml` includes:nn- Automatic deployment on push to main branchn- Manual workflow dispatch for apply/destroyn- OIDC authentication with AWSn- Terraform plan and apply stepsnn## Deployment Processnn### 1. Initial Setupnn```bashn# Clone the repositoryngit clone https://github.com/YOUR_USERNAME/book-review-portal.gitncd book-review-portalnn# Initialize Terraformncd terraformnterraform initn```nn### 2. Plan and Deploynn```bashn# Plan the deploymentnterraform plannn# Apply the configurationnterraform applyn```nn### 3. GitHub Actions Deploymentnn1. Push code to the main branchn2. GitHub Actions will automatically:n   - Initialize Terraformn   - Plan the changesn   - Apply the configurationnn### 4. Manual DeploymentnnYou can also trigger manual deployments:nn1. Go to the Actions tab in your GitHub repositoryn2. Select the "Terraform Deploy" workflown3. Click "Run workflow"n4. Choose "apply" or "destroy" actionn5. Click "Run workflow"nn## Security Considerationsnn### 1. IAM Permissionsnn- Use least privilege principlen- Regularly review and update permissionsn- Monitor access logsnn### 2. State Securitynn- Enable encryption on S3 bucketn- Use DynamoDB for state lockingn- Restrict access to state bucketnn### 3. Network Securitynn- Use private subnets for servicesn- Implement security groupsn- Enable VPC flow logsnn## Monitoring and Maintenancenn### 1. Cost Monitoringnn- Set up AWS Cost Explorer alertsn- Monitor resource usagen- Implement cost optimization strategiesnn### 2. Security Monitoringnn- Enable CloudTrailn- Monitor IAM accessn- Review security group rulesnn### 3. Application Monitoringnn- Set up CloudWatch logsn- Monitor application metricsn- Configure alerts for critical issuesnn## Troubleshootingnn### Common Issuesnn1. **OIDC Authentication Failures**:n   - Verify IAM role trust policyn   - Check GitHub repository name in trust policyn   - Ensure OIDC provider is configurednn2. **Terraform State Issues**:n   - Verify S3 bucket exists and is accessiblen   - Check DynamoDB table permissionsn   - Ensure backend configuration is correctnn3. **Resource Creation Failures**:n   - Check IAM permissionsn   - Verify resource limitsn   - Review CloudTrail logsnn## Best Practicesnn1. **Version Control**:n   - Use semantic versioningn   - Tag releasesn   - Maintain changelognn2. **Testing**:n   - Test locally before deploymentn   - Use staging environmentsn   - Implement automated testingnn3. **Documentation**:n   - Keep documentation updatedn   - Document configuration changesn   - Maintain runbooksnn## Next Stepsnn1. Customize the configuration for your specific needsn2. Set up monitoring and alertingn3. Implement backup strategiesn4. Configure disaster recovery proceduresn5. Set up development and staging environmentsnnThis setup provides a secure, scalable, and maintainable infrastructure for the Book Review Portal application.n